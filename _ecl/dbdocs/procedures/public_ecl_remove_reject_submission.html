<HTML>
<Header>
<Title>public.ecl_remove_reject_submission(subid integer) - Procedure</Title>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<Link href="../css/doc.css" rel="stylesheet" type="text/css">
</Header>
<Body>
<table class="logo">
<tr>
<td class="logo">grl [ecl.xml]</td>
</tr>
</table>
<table class="horzMenu">
<tr>
<td class="horzMenu"><a class="horzMenu" href="../index.html"> Home</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../tables/index.html">Tables</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../schemas/index.html">Schemas</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../diagrams/index.html">Diagrams</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../foreignKeys/index.html">Foreign Keys</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../indexes/index.html">Indexes</a></td><td class="horzMenuFiller"></td>
</tr>
</table>
<hr>
<table class="flat">
<tr class="banner">
<td class="title_nm">public._ecl_remove_reject_submission(subid integer)</td><td class="watermark_right">(Procedure)</td>
</tr>
<tr>
<td class="key">Name</td><td class="value">public.ecl_remove_reject_submission(subid integer)</td>
</tr>
<tr>
<td class="key">Comment</td><td class="value"> </td>
</tr>
<tr>
<td class="key">Src</td><td class="value">
<pre>
CREATE OR REPLACE FUNCTION public.ecl_remove_reject_submission(subid integer) 
  RETURNS boolean AS 
$$ 
DECLARE
 curP RECORD;
 deleteid integer;
BEGIN
    -- Check this submission is rejected. 
    select submission_id into deleteid from submissions where status_id = 3 and submission_id = subid;
    IF NOT FOUND THEN
      RAISE EXCEPTION 'submission id [%d] is not rejected', subid;
    END IF;
    
    IF deleteid <> 0 THEN
 --            
      DELETE FROM submission_external_identifier where submission_id = deleteid;
      DELETE FROM author_list where submission_id = deleteid;
      delete from data_type_list where submission_id = deleteid;
    
      -- Loop through each dataset_file_id.
      FOR curP IN
        select cast ( dataset_file_list_id as integer) as id
        from dataset_file_list where submission_id = deleteid
      LOOP       
        perform ecl_remove_dataset_file_list_id(subid, curP.id);
      End Loop;
    
      delete from dataset_file_list where submission_id = deleteid;
      delete from dataset_relation where submission_id = deleteid;
      delete from download_stats where submission_id = deleteid;
      delete from submission_keyword_map where submission_id = deleteid;
      delete from submission_relation where submission_id = deleteid;
      delete from submission_geometry where submission_id = deleteid;
      delete from submissions where submission_id = deleteid;
    
    END IF;
    RETURN true::boolean;
END;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;
</pre>
</td>
</tr>
</table>
</Body>
</HTML>
