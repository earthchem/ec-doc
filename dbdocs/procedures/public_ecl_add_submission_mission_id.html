<HTML>
<Header>
<Title>ecl_add_submission_mission_id(mission_name character varying)
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<Link href="../css/doc.css" rel="stylesheet" type="text/css">
</Header>
<Body>
<table class="logo">
<tr>
<td class="logo">grl [ecl.xml]</td>
</tr>
</table>
<table class="horzMenu">
<tr>
<td class="horzMenu"><a class="horzMenu" href="../index.html"> Home</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../tables/index.html">Tables</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../schemas/index.html">Schemas</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../diagrams/index.html">Diagrams</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../foreignKeys/index.html">Foreign Keys</a></td><td class="horzMenu">|</td><td class="horzMenu"><a class="horzMenu" href="../indexes/index.html">Indexes</a></td><td class="horzMenuFiller"></td>
</tr>
</table>
<hr>
<table class="flat">
<tr class="banner">
  <td class="title_nm">ecl_add_submission_mission_id(mission_name character varying)</td></tr>
<tr>
<td class="key">Name</td><td class="value">public._overview_constraint_info(IN ovschema name, IN ovtable name, IN ovcolumn name, OUT refschema name, OUT reftable name, OUT refcolumn name, OUT factor integer)</td>
</tr>
<tr>
<td class="key">Comment</td><td class="value"> </td>
</tr>
<tr>
<td class="key">Src</td><td class="value">
<pre>
CREATE OR REPLACE FUNCTION public.ecl_add_submission_mission_id(mission_name character varying) 
  RETURNS boolean AS 
$$ 
DECLARE
 curP RECORD;
 submitid integer;
 subhas integer;
BEGIN    
      -- Loop through each selected submissions
      FOR curP IN
         select submission_id as submission_id from submissions where ( description ilike '%'||mission_name||'%' or keywords ilike '%'||mission_name||'%' or geo_keywords ilike '%'||mission_name||'%' or title ilike '%'||mission_name||'%' ) and status_id = 2
      LOOP  
        submitid := curP.submission_id;
        RAISE NOTICE  'Add % for submission_id=% ',mission_name, submitid;
        select submission_external_identifier_id into subhas from submission_external_identifier where lower(trim(regexp_replace(external_identifier_value, '\s+', ' ', 'g'))) = lower(trim(regexp_replace(mission_name, '\s+', ' ', 'g'))) and external_identifier_system_id = 4 and submission_id = curP.submission_id; 
        
        IF NOT FOUND THEN
          begin  
            insert into submission_external_identifier (submission_id, external_identifier_system_id, external_identifier_value, external_identifier_description ) 
            values ( curP.submission_id, 4, mission_name, 'Added By data manager');
            exception
              when others then
                RAISE NOTICE  'Not add % for submission_id=%. It exisits already. ',curP.submission_id, submitid; 
          end;
        ELSE
          RAISE NOTICE  'Not add % for submission_id=%. It exisits already. ',curP.submission_id, submitid; 
        END IF;
      End Loop;
      
    RETURN true::boolean;
END;
$$
  LANGUAGE plpgsql VOLATILE 
  COST 100;
</pre>
</td>
</tr>
</table>
</Body>
</HTML>
